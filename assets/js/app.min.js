!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";class e{constructor(){this.state=null,this.basePath="https://paulcalver.co"===document.body.getAttribute("data-basepath")||"https://paulcalver.cc"===document.body.getAttribute("data-basepath")?document.body.getAttribute("data-basepath"):new URL(document.body.getAttribute("data-basepath")||window.location.origin).origin,this.supportsWebP=this.checkWebPSupport(),this.isSafari=-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome"),this.initialRoute=!0,this.currentIndex=0,this.pageTransitionTime=window.matchMedia("(max-width: 768px)").matches?10:500,this.scale=1,this.scrollSpeed=3,this.draggableInstance=null,this.handleMouseWheel=this.handleMouseWheel.bind(this),this.updateBounds=this.updateBounds.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&document.querySelector("html").classList.add("is-safari");const e=window.location.pathname;let t=e.startsWith(this.basePath)?e.slice(this.basePath.length):e;t=t.endsWith("/")&&"/"!==t?t.slice(0,-1):t;let i={path:t};if("/"===t||""===t)i={state:"featured"};else if(t.startsWith("/filter/")){i={state:"filter",filter:t.split("/filter/")[1]}}else if("/projects"===t)i={state:"index"};else if(t.startsWith("/projects/")){i={state:"project",project:t.split("/projects/")[1]}}else"/about"===t?i={state:"about"}:window.location.href=this.basePath;history.replaceState(i,"",window.location.href),this.initializeRouter(),this.handleStateChange()}isMobile(){return window.matchMedia("(max-width: 768px)").matches}isTouch(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}initializeRouter(){window.addEventListener("popstate",(e=>{this.handleStateChange()}))}navigate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var n=document.body.dataset.basepath||location.origin,r=new URL(e,n),i=r.pathname+r.search+r.hash;history.pushState(t,"",i),this.initialRoute||this.handleStateChange()}catch(e){console.error("Failed to navigate:",e)}}handleStateChange(){const e=window.location.pathname;let t=e.startsWith(this.basePath)?e.slice(this.basePath.length):e;if(t=t.endsWith("/")&&"/"!==t?t.slice(0,-1):t,"/"===t||""===t)this.setState("featured"),this.initialRoute||(this.closeIndex(),this.closeProject(),this.closeAbout()),this.showFeatured(this.initialRoute);else if(t.startsWith("/filter/")){const e=t.split("/filter/")[1];this.setState("filter",{filter:e}),this.initialRoute||(this.closeFeatured(),this.closeProject(),this.closeAbout()),this.showFilter(e,this.initialRoute)}else if("/projects"===t)this.setState("index"),this.initialRoute||(this.closeFeatured(),this.closeProject(),this.closeAbout()),this.showIndex(this.initialRoute);else if(t.startsWith("/projects/")){const e=t.split("/projects/")[1];this.setState("project",{project:e}),this.initialRoute||(this.closeFeatured(),this.closeIndex(),this.closeAbout()),this.showProject(e,null,null,this.initialRoute)}else"/about"===t?(this.setState("about"),this.initialRoute||(this.closeFeatured(),this.closeIndex(),this.closeProject()),this.showAbout(this.initialRoute)):console.error("Unknown state for relative path:",t);this.initialRoute&&(this.initialRoute=!1)}setState(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.state===e&&JSON.stringify(this.additionalData)===JSON.stringify(t)||(this.state=e,this.additionalData=t)}setActiveButton(e){document.querySelectorAll(".menu a").forEach((e=>e.classList.remove("active-button"))),e.classList.add("active-button")}showFeatured(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?0:this.pageTransitionTime;e&&this.initializePage(),document.querySelector(".featured").classList.add("active-section"),document.body.classList.add("featured-active"),this.setActiveButton(document.querySelector(".featured-link")),setTimeout((()=>{document.querySelectorAll(".featured figure").forEach((e=>{e.classList.remove("hide"),setTimeout((()=>{e.classList.remove("unfiltered-figure")}),10),setTimeout((()=>{e.classList.remove("stagger")}),1200*Math.random())})),this.isMobile()||this.initializeCanvas(document.querySelector(".featured-items"),e),this.loadMedia(document.querySelector(".featured"))}),t)}showIndex(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?0:this.pageTransitionTime;e&&this.initializePage(),this.isMobile()||this.showAdditionalMenu(document.querySelector(".filters")),document.querySelector(".index").classList.add("active-section"),document.body.classList.add("index-active"),this.setActiveButton(document.querySelector(".index-link")),document.querySelectorAll(".index figure").forEach((e=>{e.classList.add("unfiltered-figure"),e.classList.add("stagger")})),setTimeout((()=>{document.querySelectorAll(".index figure").forEach((e=>{e.classList.add("hide"),e.classList.remove("hide"),setTimeout((()=>{e.classList.remove("unfiltered-figure")}),10),setTimeout((()=>{e.classList.remove("stagger")}),1200*Math.random())})),this.isMobile()||this.initializeCanvas(document.querySelector(".index-items")),this.loadMedia(document.querySelector(".index"))}),t)}showFilter(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t?0:this.pageTransitionTime;t&&this.initializePage(),this.isMobile()||this.showAdditionalMenu(document.querySelector(".filters")),document.querySelector(".index").classList.add("active-section"),document.body.classList.add("index-active"),this.setActiveButton(document.querySelector('.filter-button[data-filter="'+e+'"]')),document.querySelectorAll(".index figure").forEach((e=>{e.classList.add("unfiltered-figure"),e.classList.add("stagger")})),setTimeout((()=>{this.isMobile()&&document.querySelector(".index").scrollTo(0,0),document.querySelectorAll(".index figure").forEach((t=>{t.classList.add("hide");const i=t.dataset.categories?t.dataset.categories.split(","):[];(!e||i.includes(e))&&(t.classList.remove("hide"),setTimeout((()=>{t.classList.remove("unfiltered-figure")}),10),setTimeout((()=>{t.classList.remove("stagger")}),300*Math.random()))})),this.isMobile()||this.initializeCanvas(document.querySelector(".index-items")),this.loadMedia(document.querySelector(".index"))}),i)}showProject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=s?0:this.pageTransitionTime;s&&this.initializePage(s),setTimeout((()=>{document.querySelector(".gallery").classList.add("active-section"),this.initializeGallery(e,t,i,s),document.body.classList.contains("hidden-page")&&(this.initializeHiddenGallery(),this.checkForCaption()),document.body.classList.add("gallery-active")}),a)}showAbout(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?0:this.pageTransitionTime;e&&this.initializePage(),this.isMobile()||this.showAdditionalMenu(document.querySelector(".external-links")),setTimeout((()=>{document.querySelector(".about").classList.add("active-section"),document.body.classList.add("about-active"),this.setActiveButton(document.querySelector(".about-link"))}),t)}closeFeatured(){setTimeout((()=>{document.querySelector(".featured").classList.remove("active-section"),document.body.classList.remove("featured-active")}),this.pageTransitionTime),document.querySelectorAll(".featured figure").forEach((e=>{e.classList.add("unfiltered-figure"),e.classList.add("stagger"),setTimeout((()=>{e.classList.add("hide")}),this.pageTransitionTime)}))}closeIndex(){setTimeout((()=>{document.querySelector(".index").classList.remove("active-section"),document.body.classList.remove("index-active")}),this.pageTransitionTime),this.isMobile()||this.hideAdditionalMenu(document.querySelector(".filters")),document.querySelectorAll(".index figure").forEach((e=>{e.classList.add("unfiltered-figure"),e.classList.add("stagger"),setTimeout((()=>{e.classList.add("hide")}),this.pageTransitionTime)}))}closeProject(){document.querySelector(".gallery").classList.remove("active-section"),document.body.classList.remove("gallery-active"),setTimeout((()=>{document.querySelector(".gallery-inner").innerHTML=""}),this.pageTransitionTime)}closeAbout(){document.querySelector(".about").classList.remove("active-section"),document.body.classList.remove("about-active"),this.isMobile()||this.hideAdditionalMenu(document.querySelector(".external-links"))}showAdditionalMenu(e){if(!e||"auto"===e.style.width)return;e.style.width="auto";const t=e.offsetWidth;e.style.width="0",gsap.to(e,{width:t,duration:.5,ease:"power4.out",onComplete:()=>{e.style.width="auto";const t=e.querySelectorAll("a");gsap.to(t,{opacity:1,duration:.5,stagger:.1})}})}hideAdditionalMenu(e){if(!e)return;const t=e.querySelectorAll("a");gsap.to(t,{opacity:0,duration:.5,stagger:-.1,onComplete:()=>{gsap.to(e,{width:0,duration:.5,ease:"power4.out"})}})}initializeMobileEvents(){document.querySelector(".mobile-button-filters").addEventListener("click",(()=>{document.body.classList.add("mobile-filters-open")})),document.querySelector(".mobile-button-menu").addEventListener("click",(()=>{document.body.classList.add("mobile-menu-open")})),document.querySelector(".mobile-button-close").addEventListener("click",(()=>{this.closeMobileMenus()}))}closeMobileMenus(){if(document.body.classList.contains("gallery-active")){document.querySelector(".project-controls .close").dispatchEvent(new Event("click",{bubbles:!0}))}else document.body.classList.remove("mobile-menu-open"),document.body.classList.remove("mobile-filters-open")}initializePage(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];gsap.registerPlugin(Draggable,InertiaPlugin),gsap.config({nullTargetWarn:!1}),this.isMobile()?this.initializeMobileEvents():(this.initializeFeaturedLayout(),this.initializeObserver()),this.initializeNavigation(e)}initializeObserver(){const e=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?gsap.to(e.target,{opacity:1,scale:1,duration:1,ease:"power2.out"}):gsap.to(e.target,{opacity:.25,scale:.9,duration:1,ease:"power2.out"})}))}),{root:null,threshold:.1});document.querySelectorAll(".index .project-link-inner, .featured .project-link-inner").forEach((t=>{e.observe(t)}))}calculateBounds(e){return{minX:-e.offsetWidth*this.scale+window.innerWidth,minY:-e.offsetHeight*this.scale+window.innerHeight,maxX:0,maxY:0}}handleMouseWheel(e){if(!this.draggableInstance)return;const t=this.draggableInstance.target,i=gsap.getProperty(t,"x"),s=gsap.getProperty(t,"y");let a=i-e.deltaX*this.scrollSpeed,o=s-e.deltaY*this.scrollSpeed;const n=this.calculateBounds(t);a=gsap.utils.clamp(n.minX,n.maxX,a),o=gsap.utils.clamp(n.minY,n.maxY,o),gsap.to(t,{x:a,y:o,duration:.3,ease:"power2.out",onUpdate:()=>this.draggableInstance.update(),onComplete:()=>this.draggableInstance.update()}),this.updateBounds()}updateBounds(){if(this.draggableInstance){const e=this.draggableInstance.target;this.draggableInstance.applyBounds(this.calculateBounds(e))}}handleMouseMove(e){if(!this.draggableInstance)return;const t=this.draggableInstance.target.closest(".container-inner"),i=e.clientX,s=e.clientY,a=50*(i/window.innerWidth-.5),o=50*(s/window.innerHeight-.5);gsap.to(t,{x:a,y:o,duration:1.5,ease:"power3.out"})}initializeCanvas(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.closest(".container-inner"),this.draggableInstance&&this.draggableInstance.kill(),window.removeEventListener("wheel",this.handleMouseWheel),window.removeEventListener("resize",this.updateBounds),window.removeEventListener("mousemove",this.handleMouseMove),this.draggableInstance=Draggable.create(e,{type:"x,y",edgeResistance:.85,inertia:!0,bounds:this.calculateBounds(e),throwProps:!0,throwResistance:2e4,maxDuration:3,minDuration:.5,onDrag:()=>{const t=this.calculateBounds(e);gsap.utils.clamp(t.minX,t.maxX,gsap.getProperty(e,"x")),gsap.utils.clamp(t.minY,t.maxY,gsap.getProperty(e,"y"))},onThrowUpdate:()=>{this.updateBounds()}})[0],window.addEventListener("wheel",this.handleMouseWheel),window.addEventListener("resize",this.updateBounds),window.addEventListener("mousemove",this.handleMouseMove);const i=window.innerWidth,s=window.innerHeight,a=(i-e.offsetWidth)/2,o=(s-e.offsetHeight)/2;if(gsap.set(e,{x:a,y:o}),e.classList.contains("featured-items")&&t){const t=.7;gsap.to(e,{scale:t,duration:0,ease:"power3.out",onUpdate:this.updateBounds()}),setTimeout((()=>{gsap.to(e,{scale:1,duration:2,ease:"power3.out",onUpdate:()=>this.updateBounds()})}),50)}}initializeFeaturedLayout(){const e=document.querySelectorAll(".featured img, .featured video");e.length,e.forEach((e=>{const t=e.closest("figure"),i=t.querySelector(".project-link-inner"),s=parseInt(e.attributes.width.value,10),a=parseInt(e.attributes.height.value,10),o=s/a,n=Math.floor(241*Math.random()+240);let r,l;s>=a?(r=n,l=Math.floor(n/o)):(l=n,r=Math.floor(n*o)),i.style.width="".concat(r,"px"),i.style.height="".concat(l,"px");t.style.padding="".concat(Math.floor(41*Math.random()+40),"px"),t.dataset.parallax=(.4*Math.random()+.1).toFixed(2)}));const t=document.querySelector(".featured-items");new Packery(".featured-items",{itemSelector:"figure",resize:!1}),t.style.width=document.querySelector(".featured-items").offsetWidth+"px"}initializeNavigation(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setNavigationListeners(e)}setNavigationListeners(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.initializeNavEvents(),this.initializeProjectsEvents(),this.initializeGalleryEvents(e)}initializeNavEvents(){document.querySelector(".home-link").addEventListener("click",(e=>{e.preventDefault(),this.isMobile&&setTimeout((()=>{this.closeMobileMenus()}),200),this.navigate("/",{state:"featured"})})),document.querySelector(".featured-link").addEventListener("click",(e=>{e.preventDefault(),this.isMobile&&setTimeout((()=>{this.closeMobileMenus()}),200),this.navigate("/",{state:"featured"})})),document.querySelector(".index-link").addEventListener("click",(e=>{e.preventDefault(),this.isMobile&&setTimeout((()=>{this.closeMobileMenus()}),200),this.navigate("/projects",{state:"index"})})),document.querySelector(".about-link").addEventListener("click",(e=>{e.preventDefault(),this.isMobile&&setTimeout((()=>{this.closeMobileMenus()}),200),this.navigate("/about",{state:"about"})}));if(document.querySelectorAll(".filter-button").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const i=e.dataset.filter;this.isMobile&&this.closeMobileMenus(),e.classList.contains("active-filter")||"all"===i?this.navigate("/projects",{state:"index"}):this.navigate("/filter/".concat(i),{state:"filter",filter:i})}))})),!this.isMobile()&&!this.isTouch()){let e;const t=document.querySelector("nav");t.addEventListener("mouseenter",(()=>{clearTimeout(e),e=setTimeout((()=>{document.body.classList.add("highlight-nav")}),500)})),t.addEventListener("mouseleave",(()=>{clearTimeout(e),document.body.classList.remove("highlight-nav")}))}}initializeProjectsEvents(){const e=document.querySelectorAll(".project-link"),t=document.querySelector(".page-title");let i=null;e.forEach((e=>{const s=e.closest("figure");this.isMobile()||this.isTouch()||(e.addEventListener("mouseenter",(()=>{this.preventInteraction||(i=setTimeout((()=>{const e=s.dataset.title;e&&(t.textContent=e,document.body.classList.add("show-title"));const i=s.closest(".index, .featured");if(i){i.querySelectorAll("figure").forEach((e=>{e!==s&&e.dataset.projectSlug!==s.dataset.projectSlug&&e.classList.add("not-selected")}))}}),500))})),e.addEventListener("mouseleave",(()=>{clearTimeout(i),i=null,document.body.classList.remove("show-title");const e=s.closest(".index, .featured");if(e){e.querySelectorAll("figure").forEach((e=>e.classList.remove("not-selected")))}}))),e.addEventListener("click",(e=>{clearTimeout(i),i=null,e.preventDefault();const a=s.dataset.title;a&&(t.textContent=a);const o=s.dataset.projectSlug;let n=null;n=document.querySelector(".featured").classList.contains("active-section")?document.querySelectorAll('.index figure[data-categories*="featured"]'):document.querySelectorAll(".index figure:not(.unfiltered-figure)"),document.body.classList.add("hold-title"),setTimeout((()=>{document.body.classList.remove("hold-title")}),1e3),this.navigate("/projects/".concat(o),{state:"project",project:o}),this.showProject(o,s,n)}))}))}initializeGalleryEvents(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=document.querySelector(".project-controls .previous"),i=document.querySelector(".project-controls .next"),s=document.querySelector(".project-controls .close"),a=document.querySelector(".gallery-inner"),o=e=>{const t=Array.from(a.querySelectorAll(".gallery-slide"));t.forEach((e=>e.classList.add("hide-slide"))),"next"===e?(this.currentIndex=(this.currentIndex+1)%t.length,this.loadAdjacentSlides(t[this.currentIndex])):"prev"===e&&(this.currentIndex=(this.currentIndex-1+t.length)%t.length,this.loadAdjacentSlides(t[this.currentIndex]));const i=t[this.currentIndex];i.classList.remove("hide-slide");i.querySelectorAll("figure").forEach((e=>{this.isSafari&&(this.setGalleryFigureWidthSafari(e),e.querySelector("video")&&setTimeout((()=>{const t=e.querySelector("video");this.setVideoDimensions(t)}),100))}));const s=t[this.currentIndex].querySelector("figure:nth-child(1)"),o=s.dataset.title;if(this.isMobile()||document.body.classList.contains("hidden-page")){const e=document.querySelector(".page-title");o&&e&&(e.textContent=o)}else{const e=document.querySelector(".page-title");o&&e&&e.textContent!==o&&gsap.timeline().to(e,{opacity:0,duration:.2,ease:"power1.out"}).add((()=>{e.textContent=o})).to(e,{opacity:1,duration:.2,ease:"power1.in"})}const n=s.dataset.projectSlug,r=t.filter((e=>e.querySelector("figure:nth-child(1)").dataset.projectSlug===n)),l=(r.indexOf(i)+1).toString().padStart(2,"0"),d=r.length.toString().padStart(2,"0"),c=document.querySelector(".project-index");c&&(c.textContent="".concat(l," | ").concat(d));const u=s.dataset.projectSlug,h=t[this.currentIndex].dataset.projectSlug;if(u&&u!==h){const e="".concat(this.basePath,"/projects/").concat(u);history.replaceState({state:"project",project:u},"",e)}document.body.classList.contains("hidden-page")&&this.checkForCaption()};this.isMobile()||document.querySelector(".gallery").addEventListener("click",(e=>{if("video"===e.target.tagName.toLowerCase()||e.target.closest("video"))return;if(e.target.closest(".gallery-slide")){const t=e.clientX,i=window.innerWidth;o(t<i/2?"prev":"next")}}));const n=new Hammer(document.querySelector(".gallery"));n.on("swiperight",(()=>{o("prev")})),n.on("swipeleft",(()=>{o("next")})),t.addEventListener("click",(()=>o("prev"))),i.addEventListener("click",(()=>o("next"))),s.addEventListener("click",(()=>{e||document.body.classList.contains("hidden-page")?window.location.href=document.body.getAttribute("data-basepath"):history.back()})),document.addEventListener("keydown",(e=>{switch(e.key){case"ArrowLeft":o("prev");break;case"ArrowRight":o("next");break;case"Escape":history.back()}}))}checkForCaption(){const e=document.querySelector(".gallery-slide:not(.hide-slide)");if(!e)return;const t=e.querySelectorAll("figure"),i=document.querySelector(".hidden-caption");let s="";t.forEach((e=>{e.dataset.caption&&(s=e.dataset.caption)})),s?(i.textContent=s,i.style.display="block"):(i.textContent="",i.style.display="none")}initializeGallery(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;const s=document.querySelector(".gallery-inner");Array.from(document.querySelectorAll(".index figure"));const a=i||document.querySelectorAll(".index figure");s.innerHTML="";const o=[],n=Array.from(a),r=new Set;n.forEach(((e,t)=>{if(r.has(t))return;const i="true"===e.dataset.isDiptych,s=n[t+1],a=(null==s?void 0:s.dataset.projectSlug)===e.dataset.projectSlug;i&&a?(o.push([e,s]),r.add(t),r.add(t+1)):(o.push([e]),r.add(t))})),o.forEach((e=>{const t=document.createElement("div");t.classList.add("gallery-slide"),e.forEach((e=>{const i=document.createElement("figure");Object.entries({title:"data-title",client:"data-client",projectUrl:"data-project-url",projectSlug:"data-project-slug",gallery:"data-gallery",galleryjpeg:"data-galleryjpeg",galleryWidth:"data-gallery-width",galleryHeight:"data-gallery-height",isDiptych:"data-is-diptych",videoUrl:"data-video-url",isPortrait:"data-is-portrait",autoplay:"data-autoplay",caption:"data-caption"}).forEach((t=>{let[s,a]=t;e.dataset[s]&&i.setAttribute(a,e.dataset[s])}));const s=void 0!==e.dataset.videoUrl,a=e.dataset.gallery,o=e.dataset.galleryWidth,n=e.dataset.galleryHeight;if(s){const t=document.createElement("video");t.src=e.dataset.videoUrl,t.poster=e.dataset.galleryjpeg||"",t.width=o?parseInt(o,10):void 0,t.height=n?parseInt(n,10):void 0,t.loop=!0,t.playsInline=!0,t.preload="metadata",e.dataset.autoplay?(t.autoplay=!0,t.muted=!0):(t.controls=!0,t.controlsList="nodownload"),t.style.aspectRatio="".concat(o,"/").concat(n),i.appendChild(t)}else if(a){const t=document.createElement("img");t.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",t.dataset.src=a,t.dataset.srcjpeg=e.dataset.galleryjpeg,t.width=o?parseInt(o,10):void 0,t.height=n?parseInt(n,10):void 0,i.appendChild(t)}t.appendChild(i)})),s.appendChild(t)}));const l=s.querySelectorAll(".gallery-slide");l.forEach((e=>e.classList.add("hide-slide")));let d=0;if(t){const e=t.dataset.gallery;d=o.findIndex((t=>Array.from(t).some((t=>t.dataset.gallery===e)))),-1===d&&(d=0)}else d=o.findIndex((t=>t.some((t=>t.dataset.projectSlug===e)))),-1===d&&(d=0);if(l[d]){const e=l[d].querySelector("figure").dataset.title,t=document.querySelector(".page-title");e&&t&&(t.textContent=e),l[d].classList.remove("hide-slide"),this.loadMedia(l[d]),this.loadAdjacentSlides(l[d]),this.currentIndex=d;l[d].querySelectorAll("figure").forEach((e=>{if(this.isSafari&&(this.setGalleryFigureWidthSafari(e),e.querySelector("video"))){const t=e.querySelector("video");setTimeout((()=>{this.setVideoDimensions(t)}),100)}}))}if(l[d]){const e=l[d].querySelector("figure").dataset.title,t=document.querySelector(".page-title");e&&t&&(t.textContent=e),l[d].classList.remove("hide-slide"),this.loadMedia(l[d]),this.loadAdjacentSlides(l[d]),this.currentIndex=d;const i=o[d],s=i[0].dataset.projectSlug,a=o.filter((e=>e.some((e=>e.dataset.projectSlug===s)))),n=String(a.indexOf(i)+1).padStart(2,"0"),r=String(a.length).padStart(2,"0"),c=document.querySelector(".project-index");c&&(c.textContent="".concat(n," | ").concat(r))}}initializeHiddenGallery(){const e=document.querySelector(".gallery .gallery-slide:first-child");this.loadAdjacentSlides(document.querySelector(".gallery .gallery-slide:first-child"));e.querySelectorAll("figure").forEach((e=>{if(this.isSafari&&(this.setGalleryFigureWidthSafari(e),e.querySelector("video"))){const t=e.querySelector("video");setTimeout((()=>{this.setVideoDimensions(t)}),100)}}))}startVideos(e){e.forEach((e=>{e.play()}))}stopVideos(e){e.forEach((e=>{e.pause()}))}loadAdjacentSlides(e){const t=Array.from(document.querySelectorAll(".gallery-slide")),i=t.findIndex((t=>t===e)),s=t.length;[(i-2+s)%s,(i-1+s)%s,i,(i+1)%s,(i+2)%s].forEach((e=>{this.loadMedia(t[e])})),t.forEach(((e,t)=>{const s=e.querySelectorAll("video");t===i?s.forEach((e=>{e.hasAttribute("autoplay")&&e.play()})):this.stopVideos(s)}))}checkWebPSupport(){const e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))&&0===e.toDataURL("image/webp").indexOf("data:image/webp")}loadMedia(e){if(!e)return void console.error("Container element not found");const t=e.querySelectorAll("figure:not(.loaded):not(.loading)");t.length&&t.forEach((e=>{e.classList.add("loading");const t=e.querySelector("video[data-src]"),i=e.querySelector("img[data-src]"),s=[];t&&(t.src=t.dataset.src,s.push(t)),i&&(i.src=this.checkWebPSupport?i.dataset.src:i.dataset.srcjpeg,s.push(i)),Promise.all(s.map((e=>new Promise((t=>{"VIDEO"===e.tagName?e.onloadeddata=t:e.onload=t,e.onerror=t}))))).then((()=>{e.classList.remove("loading"),e.classList.add("previously-loaded"),e.classList.add("loaded")}))}))}setVideoDimensions(e){requestAnimationFrame((()=>{const t=e.parentElement.clientWidth,i=e.parentElement.clientHeight,s=parseInt(e.getAttribute("width")),a=parseInt(e.getAttribute("height"));if(!s||!a)return;const o=t/s,n=i/a,r=Math.min(o,n),l=Math.round(s*r),d=Math.round(a*r);e.style.width="".concat(l,"px"),e.style.height="".concat(d,"px")}))}setGalleryFigureWidthSafari(e){if("true"!==e.dataset.isDiptych)return;const t=e.querySelector("img, video");if(!t)return;const i=this.isMobile?(window.innerWidth-40)/2:(window.innerWidth-180)/2,s=this.isMobile?window.innerHeight-100:window.innerHeight-190,a=parseInt(t.getAttribute("width")),o=parseInt(t.getAttribute("height"));if(!a||!o)return;const n=i/a,r=s/o,l=a*Math.min(n,r);e.style.width="".concat(l,"px");const d=e.nextElementSibling;if(d){const e=d.querySelector("img, video");if(e){const t=parseInt(e.getAttribute("width")),a=i/t,o=s/parseInt(e.getAttribute("height")),n=t*Math.min(a,o);d.style.width="".concat(n,"px")}}}}document.addEventListener("DOMContentLoaded",(()=>{new e}))}));
//# sourceMappingURL=app.min.js.map